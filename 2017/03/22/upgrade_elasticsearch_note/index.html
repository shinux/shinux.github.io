<!DOCTYPE html><html><head><meta charset="UTF-8"><title>elasticsearch upgrade notes</title><link rel="stylesheet" href="css/normalize.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"></head><body><div class="header"><a class="github-link" href="https://github.com/shinux"><img class="github-image" src="/images/Aquicon-Github-small.png"></a><a class="email-link" href="mailto:askb@me.com"><img class="email-image" src="/images/email-small.png"></a><a class="subscribe-link" href="/atom.xml"><img class="subscribe-image" src="/images/subscribe-small.png"></a></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">elasticsearch upgrade notes</p></h2><div class="post-date"><time datetime="2017-03-22T15:46:16.000Z">2017-03-22</time></div><div class="post-content"><h4 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h4><ul>
<li>本地下载 elasticsearch 新版本，传到服务器上解压，同时 chown -R 整个文件夹拥有者为非 root</li>
<li>所有 plugins checkout 到新版本，重新编译打包，例如 ik，然后 scp 上传到新版 elasticsearch 的 plugins 中并解压</li>
</ul>
<h4 id="Migration"><a href="#Migration" class="headerlink" title="Migration"></a>Migration</h4><ul>
<li>这两步<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/restart-upgrade.html" target="_blank" rel="external">严格按照文档</a>，disable shard allocation 和 synced flush，方便到新的集群中快速 recovery</li>
<li>停掉旧版本的 cluster</li>
<li>完整 copy data 文件夹到新版本 elasticsearch 文件夹中</li>
<li>config/elasticsearch.yml 的内容需要针对新版本做出调整</li>
</ul>
<h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><ul>
<li>开启新版 elasticsearch ，同时 enable shard allocation</li>
<li>[optional] open all indices: <code>curl -XPOST &quot;http://localhost:9200/_all/_open&quot;</code></li>
<li>等待 shard recovery，在 synced flush 的帮助下这步不会太久</li>
</ul>
<p>从 2.0 -&gt; 5.2 整体来说没有想象中那么困难，当然原本的环境就是单点大法…所以过程比较顺畅，有一些小坑，错误都比较明显。</p>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>