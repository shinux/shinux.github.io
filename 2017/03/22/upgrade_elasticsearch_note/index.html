<!DOCTYPE html><html><head><meta charset="UTF-8"><title>elasticsearch upgrade notes</title><link rel="stylesheet" href="http://obfnm2kw5.bkt.clouddn.com/normalize.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"></head><body><div class="header"><div class="header__title"><a href="/"><figure class="header__title__image"></figure></a></div><div class="header__archive"><a href="/archives"><figure class="header__archive__image"></figure><span class="header__archive__title">archive</span></a></div><div class="header__about"><a href="/about"><figure class="header__about__image"></figure><span class="header__about__title">about</span></a></div><div class="header__github"><a href="https://github.com/shinux" target="_blank"><figure class="header__github__image"></figure><span class="header__github__title">github</span></a></div><div class="header__feed"><a href="/atom.xml"><figure class="header__feed__image"></figure><span class="header__feed__title">feed</span></a></div><div class="header__notes"></div></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">elasticsearch upgrade notes</p></h2><div class="post-date"><time datetime="2017-03-22T15:46:16.000Z">2017-03-22</time></div><div class="post-content"><h4 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h4><ul>
<li>本地下载 elasticsearch 新版本，传到服务器上解压，同时 chown -R 整个文件夹权限为非 root</li>
<li>所有 plugins checkout 到新版本，编译打包，然后 scp 上传到新版 elasticsearch 的 plugins 中并解压</li>
</ul>
<h4 id="Migration"><a href="#Migration" class="headerlink" title="Migration"></a>Migration</h4><ul>
<li>这两步<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/restart-upgrade.html" target="_blank" rel="external">严格按照文档</a>，disable shard allocation 和 synced flush，方便到新的集群中快速 recovery</li>
<li>停掉旧版本的 cluster</li>
<li>完整 copy data 文件夹到新版本的文件夹中去</li>
<li>config/elasticsearch.yml 需要针对新版本做出调整</li>
</ul>
<h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><ul>
<li>开启新版 elasticsearch ，同时 enable shard allocation</li>
<li>open all indices: <code>curl -XPOST &quot;http://localhost:9200/_all/_open&quot;</code></li>
<li>等待 shard recovery，在 synced flush 的帮助下这步不会太久</li>
</ul>
<p>从 2.0 -&gt; 5.2 整体来说没有想象中那么困难，当然原本的环境就是单点大法…所以过程比较顺畅，有一些小坑，错误都比较明显。</p>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>